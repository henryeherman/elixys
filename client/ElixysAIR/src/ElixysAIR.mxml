<?xml version="1.0" encoding="utf-8"?>
<s:WindowedApplication xmlns:fx="http://ns.adobe.com/mxml/2009" xmlns:s="library://ns.adobe.com/flex/spark" xmlns:mx="library://ns.adobe.com/flex/mx"
		creationComplete="OnCreationComplete();">
	<fx:Script>
		<![CDATA[
			import mx.controls.Alert;
			import mx.controls.SWFLoader;
			import mx.rpc.events.FaultEvent;
			import mx.rpc.events.ResultEvent;
			import mx.rpc.http.HTTPService;
		
			/*** 
			 *** Member functions
			 ***/

			// Called when the application loads
			protected function OnCreationComplete():void
			{
				// Initialize the HTTP object
				m_pHTTPService = new HTTPService();
				m_pHTTPService.useProxy = false;
				m_pHTTPService.addEventListener(ResultEvent.RESULT, OnHTTPResultEvent);
				m_pHTTPService.addEventListener(FaultEvent.FAULT, OnHTTPFaultEvent);
			}
			
			// Called when the user clicks "Connect"
			protected function OnConnect():void
			{
				// Make sure the user has entered text in each field
				if (_serverip.text.length == 0)
				{
					Alert.show("Please enter the server's IP address.");
					return;
				}
				if (_username.text.length == 0)
				{
					Alert.show("Please enter your username.");
					return;
				}
				if (_password.text.length == 0)
				{
					Alert.show("Please enter your password.");
					return;
				}
				
				// Load the SWF from the remote server
				m_pHTTPService.method = "GET";
				m_pHTTPService.url = "http://" + _serverip + ":80/index.html";
				m_pHTTPService.setCredentials(_username.text, _password.text);
				m_pHTTPService.send();
			}

			// Called when the HTTP response is received from the server
			private function OnHTTPResultEvent(event:ResultEvent):void
			{
				Alert.show("Request succeeded");
			}
			
			// Called when an HTTP error occurs
			private function OnHTTPFaultEvent(event:FaultEvent):void
			{
				Alert.show("Connection to server failed: " + event.message);				
			}

			/*** 
			 *** Data members
			 ***/
			
			// HTTP service
			private var m_pHTTPService:HTTPService = null;

			protected function OnButtonClick():void
			{
				var pSWFLoader:SWFLoader = new SWFLoader();
				pSWFLoader.percentWidth = 100;
				pSWFLoader.percentHeight = 100;
				pSWFLoader.load("C:\\Elixys\\bin\\Web Server Content\\Elixys.swf");
				_viewApplication.addChild(pSWFLoader);
				_viewStack.selectedChild = _viewApplication;
			}
		]]>
	</fx:Script>
	
	<fx:Declarations>
	</fx:Declarations>

	<!-- The layout of this AIR application is straightforward: two views in a ViewStack container, one for login and another
	     to display the Elixys SWF that is hosted on a remote server. -->
	<mx:ViewStack id="_viewStack" borderStyle="solid" width="100%" height="100%">
		<mx:Canvas id="_viewLogin" width="100%" height="100%" backgroundColor="0xFF00FF">
			<s:VGroup horizontalAlign="center" verticalAlign="middle" horizontalCenter="0" verticalCenter="0" width="70%" height="70%">
				<s:Label text = "Enter the server IP address and your credentials:" />
				<s:HGroup width="100%">
					<s:VGroup width="30%">
						<s:Label text="Server IP" verticalAlign="middle" height="25" />
						<s:Label text="Username" verticalAlign="middle" height="25" />
						<s:Label text="Password" verticalAlign="middle" height="25" />
					</s:VGroup>
					<s:VGroup width="70%">
						<s:TextArea id="_serverip" text="127.0.0.1" width="100%" height="25" />
						<s:TextArea id="_username" text="devel" width="100%" height="25" />
						<s:TextArea id="_password" text="devel" displayAsPassword="true" width="100%" height="25" />
					</s:VGroup>
				</s:HGroup>
				<s:HGroup>
					<s:Button label="Exit" click="nativeApplication.exit(0);" />
					<s:Button label="Connect" click="OnConnect();" />
				</s:HGroup>
			</s:VGroup>
		</mx:Canvas>
		<mx:Canvas id="_viewApplication" width="100%" height="100%">
		</mx:Canvas>
	</mx:ViewStack>
</s:WindowedApplication>
